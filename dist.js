!function(t){var i={};function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(s,n,function(i){return t[i]}.bind(null,n));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i){let e=window.Symbol,s=0;e||((e=function(t){return`__${t}_${Math.floor(1e9*Math.random())}_${++s}__`}).iterator=e("Symbol.iterator")),window.Symbol=e},function(t,i,e){"use strict";e.r(i);e(0);class s{constructor(t="",i=0,e=0,s=0,n=0){this.img=new Image,this.img.src=t,this.width=i,this.height=e,this.x=s,this.y=n,this.visible=!0}drawToCanvas(t){this.visible&&t.drawImage(this.img,this.x,this.y,this.width,this.height)}isCollideWith(t){let i=t.x+t.width/2,e=t.y+t.height/2;return!(!this.visible||!t.visible)&&!!(i>=this.x&&i<=this.x+this.width&&e>=this.y&&e<=this.y+this.height)}}const n={poolDic:Symbol("poolDic")};class h{constructor(){this[n.poolDic]={}}getPoolBySign(t){return this[n.poolDic][t]||(this[n.poolDic][t]=[])}getItemByClass(t,i){let e=this.getPoolBySign(t);return e.length?e.shift():new i}recover(t,i){this.getPoolBySign(t).push(i)}}let o;class r{constructor(){if(o)return o;o=this,this.pool=new h,this.reset()}reset(){this.frame=0,this.score=0,this.bullets=[],this.enemys=[],this.animations=[],this.gameOver=!1}removeEnemey(t){this.enemys.shift().visible=!1,this.pool.recover("enemy",t)}removeBullets(t){this.bullets.shift().visible=!1,this.pool.recover("bullet",t)}}const a="images/bullet.png",l=16,d=30,c={speed:Symbol("speed")};let u=new r;class m extends s{constructor(){super(a,l,d)}init(t,i,e){this.x=t,this.y=i,this[c.speed]=e,this.visible=!0}update(){this.y-=this[c.speed],this.y<-this.height&&u.removeBullets(this)}}const p=window.innerWidth,g=window.innerHeight,f="images/hero.png",y=80,w=80;let b=new r;class v extends s{constructor(){super(f,y,w),this.x=p/2-this.width/2,this.y=g-this.height-30,this.touched=!1,this.bullets=[],this.initEvent()}checkIsFingerOnAir(t,i){return!!(t>=this.x-30&&i>=this.y-30&&t<=this.x+this.width+30&&i<=this.y+this.height+30)}setAirPosAcrossFingerPosZ(t,i){let e=t-this.width/2,s=i-this.height/2;e<0?e=0:e>p-this.width&&(e=p-this.width),s<=0?s=0:s>g-this.height&&(s=g-this.height),this.x=e,this.y=s}initEvent(){canvas.addEventListener("touchstart",(t=>{t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.checkIsFingerOnAir(i,e)&&(this.touched=!0,this.setAirPosAcrossFingerPosZ(i,e))}).bind(this)),canvas.addEventListener("touchmove",(t=>{t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY;this.touched&&this.setAirPosAcrossFingerPosZ(i,e)}).bind(this)),canvas.addEventListener("touchend",(t=>{t.preventDefault(),this.touched=!1}).bind(this))}shoot(){let t=b.pool.getItemByClass("bullet",m);t.init(this.x+this.width/2-t.width/2,this.y-10,10),b.bullets.push(t)}}let x=new r;const A={timer:Symbol("timer")};class E extends s{constructor(t,i,e){super(t,i,e),this.isPlaying=!1,this.loop=!1,this.interval=1e3/60,this[A.timer]=null,this.index=-1,this.count=0,this.imgList=[],x.animations.push(this)}initFrames(t){t.forEach(t=>{let i=new Image;i.src=t,this.imgList.push(i)}),this.count=t.length}aniRender(t){console.log("aniRender"),t.drawImage(this.imgList[this.index],this.x,this.y,1.2*this.width,1.2*this.height)}playAnimation(t=0,i=!1){this.visible=!1,this.isPlaying=!0,this.loop=i,this.index=t,this.interval>0&&this.count&&(this[A.timer]=setInterval(this.frameLoop.bind(this),this.interval))}stop(){this.isPlaying=!1,this[A.timer]&&clearInterval(this[A.timer])}frameLoop(){this.index++,this.index>this.count-1&&(this.loop?this.index=0:(this.index--,this.stop()))}}const S="images/enemy.png",I=60,P=60,O={speed:Symbol("speed")};let B=new r;class L extends E{constructor(){super(S,I,P),this.initExplosionAnimation()}init(t){var i,e;this.x=(i=0,e=window.innerWidth-I,Math.floor(Math.random()*(e-i)+i)),this.y=-this.height,this[O.speed]=t,this.visible=!0}initExplosionAnimation(){let t=[];for(let i=0;i<19;i++)t.push("images/explosion"+(i+1)+".png");this.initFrames(t)}update(){this.y+=this[O.speed],this.y>window.innerHeight+this.height&&B.removeEnemey(this)}}const _=window.innerWidth,C=window.innerHeight,D="images/bg.jpg",T=512,F=512;class H extends s{constructor(t){super(D,T,F),this.top=0,this.render(t)}update(){this.top+=2,this.top>=C&&(this.top=0)}render(t){t.drawImage(this.img,0,0,this.width,this.height,0,-C+this.top,_,C),t.drawImage(this.img,0,0,this.width,this.height,0,this.top,_,C)}}const j=window.innerWidth,M=window.innerHeight;let W,X=new Image;X.src="images/Common.png";class Y{renderGameScore(t,i){t.fillStyle="#ffffff",t.font="20px Arial",t.fillText(i,10,30)}renderGameOver(t,i){t.drawImage(X,0,0,119,108,j/2-150,M/2-100,300,300),t.fillStyle="#ffffff",t.font="20px Arial",t.fillText("游戏结束",j/2-40,M/2-100+50),t.fillText("得分: "+i,j/2-40,M/2-100+130),t.drawImage(X,120,6,39,24,j/2-60,M/2-100+180,120,40),t.fillText("重新开始",j/2-40,M/2-100+205),this.btnArea={startX:j/2-40,startY:M/2-100+180,endX:j/2+50,endY:M/2-100+255}}}class G{constructor(){if(W)return W;W=this,this.bgmAudio=new Audio,this.bgmAudio.loop=!0,this.bgmAudio.src="audio/bgm.mp3",this.shootAudio=new Audio,this.shootAudio.src="audio/bullet.mp3",this.boomAudio=new Audio,this.boomAudio.src="audio/boom.mp3",this.playBgm()}playBgm(){this.bgmAudio.play()}playShoot(){this.shootAudio.currentTime=0,this.shootAudio.play()}playExplosion(){this.boomAudio.currentTime=0,this.boomAudio.play()}}let k=canvas.getContext("2d"),R=new r;new class{constructor(){this.aniId=0,this.restart()}restart(){R.reset(),canvas.removeEventListener("touchstart",this.touchHandler),this.bg=new H(k),this.player=new v(k),this.gameinfo=new Y,this.music=new G,this.bindLoop=this.loop.bind(this),this.hasEventBind=!1,window.cancelAnimationFrame(this.aniId),this.aniId=window.requestAnimationFrame(this.bindLoop)}enemyGenerate(){if(R.frame%30==0){let t=R.pool.getItemByClass("enemy",L);t.init(6),R.enemys.push(t)}}collisionDetection(){let t=this;R.bullets.forEach(i=>{for(let e=0,s=R.enemys.length;e<s;e++){let s=R.enemys[e];if(!s.isPlaying&&s.isCollideWith(i)){s.playAnimation(),t.music.playExplosion(),i.visible=!1,R.score+=1;break}}});for(let t=0,i=R.enemys.length;t<i;t++){let i=R.enemys[t];if(this.player.isCollideWith(i)){R.gameOver=!0;break}}}touchEventHandler(t){t.preventDefault();let i=t.touches[0].clientX,e=t.touches[0].clientY,s=this.gameinfo.btnArea;i>=s.startX&&i<=s.endX&&e>=s.startY&&e<=s.endY&&this.restart()}render(){k.clearRect(0,0,canvas.width,canvas.height),this.bg.render(k),R.bullets.concat(R.enemys).forEach(t=>{t.drawToCanvas(k)}),this.player.drawToCanvas(k),R.animations.forEach(t=>{t.isPlaying&&t.aniRender(k)}),this.gameinfo.renderGameScore(k,R.score),R.gameOver&&(this.gameinfo.renderGameOver(k,R.score),this.hasEventBind||(this.hasEventBind=!0,this.touchHandler=this.touchEventHandler.bind(this),canvas.addEventListener("touchstart",this.touchHandler)))}update(){R.gameOver||(this.bg.update(),R.bullets.concat(R.enemys).forEach(t=>{t.update()}),this.enemyGenerate(),this.collisionDetection(),R.frame%20==0&&(this.player.shoot(),this.music.playShoot()))}loop(){R.frame++,this.update(),this.render(),this.aniId=window.requestAnimationFrame(this.bindLoop,canvas)}}}]);